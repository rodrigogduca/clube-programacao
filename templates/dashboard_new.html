{% extends 'base.html' %}

{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Dashboard</h2>
    <div>
      {% if admin %}
        <a class="btn btn-orange" href="/admin/">Ir para Admin</a>
      {% endif %}
    </div>
  </div>

  {% if admin %}
    <div class="row g-3 mb-4">
      <div class="col-md-4">
        <div class="card-soft">
          <h6>Membros</h6>
          <p class="display-6 mb-0">{{ users|length }}</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card-soft">
          <h6>Tarefas</h6>
          <p class="display-6 mb-0">{{ tasks|length }}</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card-soft">
          <h6>Taxa média de conclusão</h6>
          <p class="display-6 mb-0">—</p>
        </div>
      </div>
    </div>

    <h5 class="mb-2">Rendimento dos membros</h5>
    <div class="card-soft mb-4">
      <div class="table-responsive">
        <table class="table table-borderless align-middle mb-0">
          <thead>
            <tr><th>Usuário</th><th>Tarefas atribuídas</th><th>Concluídas</th><th>%</th></tr>
          </thead>
          <tbody>
            {% for u in users %}
              <tr>
                <td>{{ u.username }}</td>
                <td>{{ u.total_assigned }}</td>
                <td>{{ u.completed_tasks }}</td>
                <td>{{ u.completion_rate|floatformat:1 }}%</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <h5>Tarefas recentes</h5>
    <div class="row g-3">
      {% for t in tasks|slice:":6" %}
        <div class="col-md-6">
          <div class="task-card">
            <div class="flex-grow-1">
              <h6 class="mb-1"><a href="/tarefas/{{ t.pk }}/">{{ t.title }}</a></h6>
              <div class="text-muted">{{ t.assigned_to }}</div>
            </div>
            <div class="text-end">
              {% if t.completed %}<span class="badge-complete">Concluída</span>{% else %}<span class="badge-pending">Pendente</span>{% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <h4>Suas tarefas</h4>
    <div class="row g-3">
      {% for t in tasks %}
        <div class="col-md-6">
          <div class="task-card">
            <div class="flex-grow-1">
              <h6 class="mb-1"><a href="/tarefas/{{ t.pk }}/">{{ t.title }}</a></h6>
              <div class="text-muted">{{ t.created_at|date:"d/m/Y" }}</div>
            </div>
            <div class="text-end">
              {% if t.completed %}<span class="badge-complete">Concluída</span>{% else %}<span class="badge-pending">Pendente</span>{% endif %}
            </div>
          </div>
        </div>
      {% empty %}
        <div class="col-12"><div class="card-soft">Nenhuma tarefa atribuída.</div></div>
      {% endfor %}
    </div>
  {% endif %}

{% endblock %}
